\usepackage[utf8x]{inputenc}
\usepackage{hyperref}


% Utilities

% Patching the bibliography for author-title

\usepackage{xpatch}

% Biblatex
\usepackage[style=british]{csquotes}
\usepackage[backend=biber, style=authortitle-ticomp, sorting=nyt, ibidpage=true,backref=false]{biblatex}

\renewcommand{\mkbibnamefamily}[1]{\textsc{#1}} 

\renewcommand{\UrlFont}{\sc}

\renewcommand*{\mkibid}[1]{\mkbibemph{#1}}

\DeclareFieldFormat{eprint:jstor}{%
	\mkbibacro{JSTOR}\addcolon\space
	\ifhyperref
	{\href{https://www.jstor.org/stable/#1}{\nolinkurl{#1}}}
	{\nolinkurl{#1}}}


\DeclareSortingTemplate{nyt}{
%	\sort{
%		\field{presort}
%	}
%	\sort[final]{
%		\field{sortkey}
%	}
%	\sort{
%		\field{sortname}
%		\field{author}
%		\field{editor}
%		\field{translator}
%		\field{shorttitle}
%		\field{title}
%	}
%	\sort{
%		\field{sortyear}
%		\field{year}
%	}
	\sort{
%		\field{sorttitle}
		\field{author}
		\field{shorttitle}
		\field{title}
	}
	\sort{
		\field{volume}
		\literal{0}
	}
}

\AtBeginBibliography{
	% \xpretobibmacro{author}{\mkbibbold\bgroup}{}{}
	% \xapptobibmacro{author}{\egroup}{}{}
	% \xpretobibmacro{bbx:editor}{\mkbibbold\bgroup}{}{}
	% \xapptobibmacro{bbx:editor}{\egroup}{}{}
	\renewcommand{\mkbibnamefamily}[1]{\textsc{#1}}

	\newbibmacro{string+doiurlisbn}[1]{#1}
	
	\newbibmacro*{jlt}{%
		\usebibmacro{string+doiurlisbn}{\printtext[title]{%
		\printfield[titlecase]{title}%
		\printfield[titlecase]{subtitle}}}%	
	}

	\newbibmacro*{jltb}{%
	\usebibmacro{string+doiurlisbn}{\mkbibbold{\printtext[title]{%
			\printfield[titlecase]{title}%
			\printfield[titlecase]{subtitle}}}}%	
	}	

	\newbibmacro*{slt}{%
		\mkbibbold{\printtext[title]{\printfield[titlecase]{shorttitle}}}{\,=\,}%
		\usebibmacro{jlt}%
	}
	
	\renewbibmacro*{title}{%
		\unspace
		\iffieldundef{shorttitle}%
			{\ifsingletitle%
				{\usebibmacro{jlt}}%
				{\usebibmacro{jltb}}%
			}%
			{\ifkeyword{primary}%
				{\usebibmacro{slt}}%
				{\ifsingletitle%
					{\usebibmacro{jlt}}%
					{\usebibmacro{slt}}%
				}%
			}%
		\printfield{titleaddon}%
	}

	\DeclareFieldFormat{shortitle}{\textsc{#1}}
}

% THEOREMS

\usepackage{amsthm}

\newtheoremstyle{loo}%
	{\parskip}% space below
	{0em}% space above
	{} % body font
	{\parindent} % indent
	{\itshape} % theorem head font
	{.} % punctuation after theorem head
	{ }
	{\hspace{-\fnindent}\makebox[\fnindent][l]{{\thmnumber{#2}}}\thmname{#1}\thmnote{ (#3)}}

\theoremstyle{loo}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{result}[theorem]{Result}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\makeatletter
\renewenvironment{proof}[1][\proofname]{%
	\begin{enumerate}[nosep,leftmargin=0em,itemindent=\fnindent,parsep=\parskip,listparindent=\RaggedRightParindent]
		\item[]	\pushQED{\qed}\emph{#1}. \ignorespaces
}{%
	\popQED\end{enumerate}%
}
\makeatother

